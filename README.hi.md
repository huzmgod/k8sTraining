# k8sрдкреНрд░рд╢рд┐рдХреНрд╖рдг

рдЕрдкрд╛рдЪреЗ, рдирдЧреНрдиреЗрдХреНрд╕, рдЬреЗрдирдХрд┐рдВрд╕, рдЗрд╕реНрддрд┐рдпреЛ, рдХрд┐рдЖрд▓реА (рдлрд┐рд▓рд╣рд╛рд▓)

рдЬрд╛рдБрдЪ рдХрд░рдирд╛**_рдЯреНрд░реЗрдирд┐рдВрдЧрдкрд╛рдердкреНрд░реЛрдЬреЗрдХреНрдЯ.рдкреАрдбреАрдПрдл_**рдкреВрд░реНрдг рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП ЁЯШК

рдкреВрд░реЗ рдкрд░рд┐рджреГрд╢реНрдп рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:

```bash
./autoDeploy.sh
```

рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдзреАрд░реЗ-рдзреАрд░реЗ рдЦреЗрд▓рдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗ, рддреЛ рдмрд╕:

```bash
git clone https://github.com/huzmgod/k8sTraining.git
cd k8sTraining
```

**_-----------------------------------------------------------------------------------------------------------------------_**

**_рд╕реНрдкреИрдирд┐рд╢ рдкреВрд░реНрдг README (рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛, рдЬреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рд╣реИрдВ):_**

**K8s рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Apache рдХреЗ рд▓рд┐рдП Nginx рдХреЛ рд░рд┐рд╡рд░реНрд╕ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд░рдирд╛ред рдЬреЗрдирдХрд┐рдВрд╕, рдЗрд╕реНрддрд┐рдпреЛ, K8s рдбреИрд╢рдмреЛрд░реНрдб рдФрд░ рдХрд┐рдЖрд▓реА рддреИрдирд╛рдд**

1.  **рдЗрдВрд╕реНрдЯрд╛рд▓рд░ рдкреНрд░рдХрд╛рд░:[рд╣рддреНрддрдкрдГ://рдХрд╛рдЗрдВрдб.рд╕рд┐рдЧреНрд╕.рдЦ8рд╕.реАреЛ/рдбреЙрдХреНрд╕/рдпреВрдЬрд░/рдХреНрд╡рд┐рдХ-рд╕реНрдЯрд╛рд░реНрдЯ/#рдЗрдВрд╕реНрдЯрд╛рд▓реЗрд╢рди](https://kind.sigs.k8s.io/docs/user/quick-start/#installation)**
2.  **рдХреНрд▓рд╕реНрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ (cluster-config.yaml):**

рдХреНрд▓рд╕реНрдЯрд░-config.yaml

```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
 extraPortMappings:
 - containerPort: 30000
   hostPort: 30000
   protocol: TCP
```

**рдЧреНрд░реЗрдб:**

-   рдПрдХреНрд╕реНрдЯреНрд░рд╛рдкреЛрд░реНрдЯрдореИрдкрд┐рдВрдЧ рдЙрди рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдЬреЛ рдбреЙрдХрд░ рдбреЗрд╕реНрдХрдЯреЙрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЕрдиреНрдпрдерд╛ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ: 30000 (рдпрд╛ 30000 рд╕реЗ рдмрдбрд╝рд╛ рдХреЛрдИ рдЕрдиреНрдп рдкреЛрд░реНрдЯ) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдкрд╛рдЪреЗ (рдпрд╛ рдЕрдиреНрдп) рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рд╛рдордЧреНрд░реА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред рдЕрдзрд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рд▓рд┐рдП:[рд╣рддреНрддрдкрдГ://рдХрд╛рдЗрдВрдб.рд╕рд┐рдЧреНрд╕.рдЦ8рд╕.реАреЛ/рдбреЙрдХреНрд╕/рдпреВрдЬрд░/рдХреЙрдиреНреЮрд┐рдЧрд░реЗрд╢рди/#рдПрдХреНрд╕реНрдЯреНрд░рд╛-рдкреЛрд░реНрдЯ-рдордкреНрдкрд┐рдВрдЧреНрд╕](https://kind.sigs.k8s.io/docs/user/configuration/#extra-port-mappings)\*\*

-   рд╢реНрд░рдорд┐рдХреЛрдВ рдХреЛ рд▓рд╛рдЗрди рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

```yaml
-role: worker
```

3.  **рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рдПрдВ рдФрд░ рд╕реНрдерд┐рддрд┐ рдЬрд╛рдВрдЪреЗрдВ:**

```bash
kind create cluster --config=cluster kubectl cluster-info
kubectl cluster-info
```

4.  **рдкреЙрдб рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ (рдЕрдкрд╛рдЪреЗ рдФрд░ Nginx):**

**рдЙрдкрдпреЛрдЧ:**Kubectl apply -f рдкрд░ рдмрдЪрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рдФрд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди рджреЛрдиреЛрдВ рдПрдХ рд╣реА yaml рдореЗрдВ рд╣реИрдВред рдЖрдк рдкрд░рд┐рдирд┐рдпреЛрдЬрди рд╕рдордп рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**nginx.yaml:**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx
spec:
  type: NodePort
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: 80
    nodePort: 30000
  selector:
    app: nginx
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  selector:
    matchLabels:
      app: nginx
  replicas: 1
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        volumeMounts:
        - name: nginx-conf
          mountPath: /etc/nginx/
      volumes:
      - name: nginx-conf
        configMap:
          name: nginx-conf
```

рдЕрдкрд╛рдЪреЗ.yaml:

```yaml

apiVersion: v1
kind: Service
metadata:
  name: apache
  labels:
    app: apache
spec:
  ports:
  - name: http
    port: 8080
    targetPort: 80
  selector:
    app: apache
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: apache
spec:
  selector:
    matchLabels:
      app: apache
  replicas: 1
  template:
    metadata:
      labels:
        app: apache
    spec:
      containers:
      - name: apache
        image: httpd:latest
        ports:
        - containerPort: 80
        volumeMounts:
        - name: html
          mountPath: /usr/local/apache2/htdocs/
      volumes:
      - name: html
        configMap:
          name: html
```

5.  **nginx рдХреЛ рд░рд┐рд╡рд░реНрд╕ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд┐рдЧ рдореИрдк рдмрдирд╛рдПрдВ (nginx-conf.yaml)**

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-conf
data:
  nginx.conf: |
    events {
      worker_connections  1024;
    }

    http {
      server {
        listen 80;
        server_name localhost;

        location / {
          index index.html;
          proxy_pass http://apache:8080/;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
      }
    }
```

**рдЧреНрд░реЗрдб:**

-   _рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдирд┐рд░реНрджреЗрд╢\_рдХрдиреЗрдХреНрд╢рди рдПрдХ рд╕рд╛рде рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдзрд┐рдХрддрдо рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ Nginx рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕реЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕реНрдХреЗрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, 1024 рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИред_
-   _nginx рдкреЙрдб рдХреЗ рд╕рд╛рде рдЯрдХрд░рд╛рд╡ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрд╛рдЪреЗ рдкреЛрд░реНрдЯ 80 рдХреЛ 8080 рдкрд░ рдореИрдк рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред_

6.  **рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд▓рд╛рдЧреВ рдХрд░реЗрдВ:**

```bash
kubectl apply -f nginx.yaml
kubectl apply -f apache.yaml
kubectl apply -f nginx-conf.yaml
```

рд╣рдо рдЬрд╛рдБрдЪрддреЗ рд╣реИрдВ рдХрд┐ рд╕рдм рдХреБрдЫ рдареАрдХ рдЪрд▓ рд░рд╣рд╛ рд╣реИ

```bash
kubectl get pods
kubectl exec <nombre de tu pod de nginx> -- cat /etc/nginx/nginx.conf
```

7.  **рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХрд╕реНрдЯрдо HTML рд╣реИ рддреЛ рд╣рдо рдЗрд╕реЗ nginx рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕ рдмрд┐рдВрджреБ рддрдХ рд╕рдм рдХреБрдЫ рдареАрдХ рд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред**

_рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рдЫреЛрдбрд╝реА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдХрд╕реНрдЯрдо.рдПрдЪрдЯреАрдПрдордПрд▓ рдФрд░ рдХрд╕реНрдЯрдо.рд╕реАрдПрд╕рдПрд╕ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡реЗ рдХреЛрдИ рдЕрдиреНрдп рднреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдпрд╣ рдПрдХ рдбреНрд░реИрдЧрди рдмреЙрд▓ html рд╣реИ рдЬреЛ рдмрд╣реБрдд рдмрдврд╝рд┐рдпрд╛ рд╣реИред_

-   **рд╣рдо html рдФрд░ css рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрдореИрдк рдмрдирд╛рддреЗ рд╣реИрдВ:**

```bash
kubectl create configmap html --from-file=custom.html --from-file=custom.css
```

рдзреНрдпрд╛рди рджреЗрдВ: html.yaml рдлрд╝рд╛рдЗрд▓ рдХреЛ kubectl рдХреЗ рд╕рд╛рде рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрдореИрдк рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЫреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ

```bash
apply -f html.yaml
```

_рдпрд╣ рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдб рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред_

-   **рд╣рдо apache.yaml рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдПрдХ рдорд╛рдЙрдВрдЯ рдкреЙрдЗрдВрдЯ рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡реЙрд▓реНрдпреВрдо рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ:**

```yaml
...
spec:
      containers:
      - name: apache
        image: httpd:latest
        ports:
        - containerPort: 80
        volumeMounts:
        - name: html
          mountPath: /usr/local/apache2/htdocs/
      volumes:
      - name: html
        configMap:
          name: html
```

-   **рд╣рдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ:**

```bash
kubectl apply -f apache.yaml
```

-   **рд╣рдо рдЬрд╛рдБрдЪрддреЗ рд╣реИрдВ рдХрд┐ рд╕рдм рдХреБрдЫ рд▓реЛрдб рд╣реЛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд░рд┐рд╡рд░реНрд╕ рдкреНрд░реЙрдХреНрд╕реА рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣реА рд╣реИ:**

```bash
kubectl exec <nombre de tu pod de nginx> -- curl localhost/custom.html
```

8.  **рдЕрдм рддрдХ рд╣рдореЗрдВ рдЗрд╕реЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд▓реЗрдирд╛ рдЪрд╛рд╣рд┐рдПред**

**рдФрд░ localhost:30000 рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдо рдЕрдкрдиреЗ customer.html рд╡реЗрдм рдкреЗрдЬ рддрдХ рдкрд╣реБрдВрдЪ рдкрд╛рдПрдВрдЧреЗ**

9.  **рдпрджрд┐ рдЕрдм рддрдХ рд╕рдм рдХреБрдЫ рдареАрдХ рд░рд╣рд╛ рд╣реИ, рддреЛ рдмрдврд╝рд┐рдпрд╛ рд╣реИ, рдпрд╣реА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЕрдиреНрдпрдерд╛, рдореИрдВрдиреЗ рдПрдХ kustomization.yaml рдлрд╝рд╛рдЗрд▓ рдЫреЛрдбрд╝реА рд╣реИ рдЬреЛ рд╕рдм рдХреБрдЫ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП kustomize рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИред рдпрджрд┐ рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖ рд╣реЛ, рддреЛ рдирд┐рдореНрди рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ:**

```bash
kind delete cluster тАУ-name=<nombreDeTuCluster>
kind create cluster --config=cluster-config.yaml --name=<nombre-que-quieras>
kubectl apply -k .
```

**рд╕рдм рддреИрдпрд╛рд░ред рдЙрдкрд░реЛрдХреНрдд рдЬрд╛рдБрдЪ рдХрд░реЗрдВ (nginx.conf, localhost:30000, рдЖрджрд┐) рдиреЛрдЯ:**

-   **рдХреЙрдкреА рдФрд░ рдкреЗрд╕реНрдЯ рдХрд░рддреЗ рд╕рдордп рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ, рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣рдореЗрд╢рд╛ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХреЙрдкреА рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВред**
-   **рдореИрдВ рдЬрд╛рдирддрд╛ рд╣реВрдВ рдХрд┐ рдпрд╣ рдкрд╣рд▓реЗ рд╣реА рдЕрдЪреНрдЫрд╛ рд╣реЛрддрд╛, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рд╢реБрд░реВ рд╕реЗ рд╣реА рд╣рд░ рдЪреАрдЬ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛**ЁЯШК**.**

**---------------------------------- K8S рдбреИрд╢рдмреЛрд░реНрдб---------------- ----------------------**

**рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЬреЛ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рд╣реИ рд╡рд╣ рдЗрд╕реНрддрд┐рдпреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд╣реАрдВ рд╣реИ, рдмрд▓реНрдХрд┐ K8s рдбреИрд╢рдмреЛрд░реНрдб рдХрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реИред рдореЗрдЯреНрд░рд┐рдХреНрд╕ рджреЗрдЦрдирд╛ рдФрд░ рдХреНрд▓рд╕реНрдЯрд░ рдХреА рд╕реНрдерд┐рддрд┐ рджреЗрдЦрдирд╛ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реИ (рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА \[рдореЗрдВ)[рд╣рддреНрддрдкрдГ://рд┐рд╕реНрддрд┐рдУ.реАреЛ/рд▓реЗрдЯреЗрд╕реНрдЯ/рдбреЙрдХреНрд╕/рд╕реЗрдЯрдЕрдк/рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдо](https://istio.io/latest/docs/setup/platform)- рд╕реЗрдЯрдЕрдк/рддрд░рд╣/#рд╕реЗрдЯрдЕрдк-рдбреИрд╢рдмреЛрд░реНрдб-рдпреВрдЖрдИ-рдлреЙрд░-рдХрд╛рдЗрдВрдб):**]([рд╣рддреНрддрдкрдГ://рд┐рд╕реНрддрд┐рдУ.реАреЛ/рд▓реЗрдЯреЗрд╕реНрдЯ/рдбреЙрдХреНрд╕/рд╕реЗрдЯрдЕрдк/рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдо-рд╕реЗрдЯрдЕрдк/рдХрд╛рдЗрдВрдб/#рд╕реЗрдЯрдЕрдк-рдбреИрд╢рдмреЛрд░реНрдб-реБрдЗ-рдлреЙрд░-рдХрд╛рдЗрдВрдб](https://istio.io/latest/docs/setup/platform-setup/kind/#setup-dashboard-ui-for-kind))\*\*

1.  **рд╣рдо рдбреИрд╢рдмреЛрд░реНрдб рдкрд░рд┐рдирд┐рдпреЛрдЬрди рддреИрдирд╛рдд рдХрд░рддреЗ рд╣реИрдВ:**

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommende d.yaml --validate=false
```

2.  \*\*рд╣рдо рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдкреЙрдб рдЙрдкрд▓рдмреНрдз рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:

```bash
kubectl get pod -n kubernetes-dashboard
```

3.  **рд╣рдо рдХреНрд▓рд╕реНрдЯрд░ рддрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ ServiceAccount рдФрд░ ClusterRoleBinding рдмрдирд╛рддреЗ рд╣реИрдВ:**

```bash
kubectl create serviceaccount -n kubernetes-dashboard admin-user

kubectl create clusterrolebinding  -n kubernetes-dashboard admin-user  --clusterrole cluster-admin --serviceaccount=kubernetes-dashboard:admin-user
```

4.  **рд╣рдо рдЯреЛрдХрди рдЬрдирд░реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдлрд┐рд░ рд╣рдорд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдЧрд╛:**

```bash
token=$(kubectl  -n  kubernetes-dashboard  describe  secret  $(kubectl  -n  kubernetes - dashboard get secret | awk '/^admin-user/{print $1}') | awk '$1=="token:"{print $2}')
```

5.  **рд╣рдо рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕реЗ рдЯреЛрдХрди рд╡реЗрд░рд┐рдПрдмрд▓: рдЗрдХреЛ $рдЯреЛрдХрди рдореЗрдВ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**
6.  **рд╣рдо рд╕реАрдПрд▓рдЖрдИ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреИрд╢рдмреЛрд░реНрдб рддрдХ рдпрд╣ рд▓рд┐рдЦрдХрд░ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:**

```bash
kubectl proxy
```

**рдЕрдм рд╣рдо рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗ \[http&#x3A;//localhost:8001/api/v1/namespaces/kubernetes - Dashboard/services/https&#x3A;kubernetes-dashboard:/proxy/#/login рдкрд░ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ**](http&#x3A;//localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https&#x3A;kubernetes-dashboard:/proxy/#/login)\*\*

7.  **рдПрдХ рдмрд╛рд░ рдЯреЛрдХрди рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рд╡реЗрдм рд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рдбреИрд╢рдмреЛрд░реНрдб рддрдХ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ рд╕реЗрд╡рд╛рдПрдВ, рдЖрджрд┐):**

**------------------------------------------------ рдЬреЗрдирдХреАрдВрд╕ - ------------------------------------------------**

1.  **рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЬреЗрдирдХрд┐рдВрд╕ рдХреЛ рднреА рдкреЗрд╢ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред рд╣рдо рд╣реЛрд╕реНрдЯрдкреЛрд░реНрдЯ 30001 рдкрд░ рдореИрдк рдХрд┐рдП рдЧрдП рдиреЛрдбрдкреЛрд░реНрдЯ рдкреНрд░рдХрд╛рд░ рдХреА рдПрдХ рд╕реЗрд╡рд╛ рдмрдирд╛рдПрдВрдЧреЗ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦреЗрдВрдЧреЗред yaml рдлрд╝рд╛рдЗрд▓ рдЬрд┐рд╕рдореЗрдВ рдкрд░рд┐рдирд┐рдпреЛрдЬрди рдФрд░ рд╕реЗрд╡рд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рд╡рд╣ рд╣реИ:**

**рдЬреЗрдирдХреАрдВрд╕.yaml:**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: jenkins
spec:
  type: NodePort
  selector:
    app: jenkins
  ports:
    - name: http
      port: 8080
      targetPort: 8080
      nodePort: 30001
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: jenkins
spec:
  selector:
    matchLabels:
      app: jenkins
  replicas: 1
  template:
    metadata:
      labels:
        app: jenkins
    spec:
      containers:
        - name: jenkins
          image: jenkins/jenkins:lts
          ports:
            - containerPort: 8080
            - containerPort: 50000
```

2.  **рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╣рдо рд╕реЛрдЪ рд░рд╣реЗ рд╣реЛрдВрдЧреЗ рдХрд┐ рд╣рдо рдЬреЗрдирдХрд┐рдВрд╕ рдХреЛ рдХрд╣рд╛рдВ рдмреЗрдирдХрд╛рдм рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реЛрдЧрд╛ рдХрд┐ рдЗрд╕реЗ "рд╕реНрдерд╛рди рдЬреЗрдирдХреАрдВрд╕/" рдореЗрдВ nginx рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ:30000/рдЬреЗрдирдХреАрдВрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдП - рдЖрдкрдХреЛ рдХреЗрд╡рд▓ nginx-conf.yaml рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛**


    location /jenkins {

        proxy\_pass http://<jenkinsPodUsedIp>:30001/;
        proxy\_set\_header Host $host;
        proxy\_set\_header X-Real-IP $remote\_addr;
        proxy\_set\_header X-Forwarded-For $proxy\_add\_x\_forwarded\_for; proxy\_set\_header X-Forwarded-Proto $scheme;

    }

_рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, wsl2 рдХреЗ рд╕рд╛рде рд╕рдВрдЧрддрддрд╛ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг рдореИрдВ рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ред рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рдХреНрд▓рд╕реНрдЯрд░-config.yaml рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рдПрдХреНрд╕реНрдЯреНрд░рд╛рдкреЛрд░реНрдЯрдореИрдкрд┐рдВрдЧ рд▓рд┐рдЦ рд░рд╣рд╛ рд╣реВрдВ рдЬрд┐рд╕рдХреА рд╣рдореЗрдВ рдмрд╛рдж рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдореИрдВрдиреЗ рдХреБрдЫ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рд╣реИ рдФрд░ рдмрд╛рдж рдореЗрдВ рдПрдХ рдЗрдирдЧреНрд░реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓рд░ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рд╕реНрдЯрд░ рдореЗрдВ рдПрдХ рдЯреИрдЧ рдЬреЛрдбрд╝рд╛ рд╣реИ:_

**рдХреНрд▓рд╕реНрдЯрд░-config.yaml**

```yaml
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
  - containerPort: 8080
    hostPort: 8080
    protocol: TCP
  - containerPort: 30000
    hostPort: 30000
    protocol: TCP
  - containerPort: 30001
    hostPort: 30001
    protocol: TCP
- role: worker
- role: worker
```

3.  **рдЕрдм, рдЖрдк рдЕрдкрдиреЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЬреЗрдирдХреАрдВрд╕ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдХрд┐рд╕реА рднреА рдмрд┐рдВрджреБ рдкрд░ рдЖрдк рдЦреЛ рдЧрдП рд╣реИрдВ, рддреЛ autoDeploy.sh рдирд╛рдордХ рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд╕рдВрдкреВрд░реНрдг рдкрд░рд┐рджреГрд╢реНрдп рджрд┐рдЦрд╛рддреА рд╣реИред рдЙрди рд╣рд┐рд╕реНрд╕реЛрдВ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░реЗрдВ рдЬрд┐рди рддрдХ рдЖрдк рдирд╣реАрдВ рдкрд╣реБрдБрдЪреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕реНрд╡рдпрдВ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХреЗрдВ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХреЗрдВ:**

```bash
./autoDeploy.sh
```

4.  **рдЕрдВрдд рдореЗрдВ, рд╣рдо nginx рдХреЛ localhost:30000 рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдФрд░ рдЬреЗрдирдХрд┐рдВрд╕ рдХреЛ localhost:30001 рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ nginx рдХреИрд╕реЗ рдЪрд▓рддрд╛ рд╣реИ, рдЖрдЗрдП рдЬреЗрдирдХреАрдВрд╕ рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВ:**

-   _рдЬреЗрдирдХреАрдВрд╕ рдЕрдирд▓реЙрдХ рдХрд░реЗрдВ:_**рд╣рдореЗрдВ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ. рд╣рдо рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ:**

```bash
kubectl get pods
kubectl exec <nombre-pod-jenkins> -- cat** /var/jenkins\_home/secrets/initialAdminPassword**
```

-   **рд╣рдо рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ:30001 рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВред**

-   **рдЕрдиреБрд╢рдВрд╕рд┐рдд рдкреНрд▓рдЧрдЗрдиреНрд╕ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ, рдЕрдкрдирд╛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдПрдВ рдФрд░ рддреИрдпрд╛рд░!**

**рдЧреНрд░реЗрдб:**

-   **рдпрджрд┐ рдЖрдк "рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ" рд╕реЗ рдЕрдзрд┐рдХ рдЖрдХрд░реНрд╖рдХ рдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЕрдкрдиреА рдорд╢реАрди рдкрд░ 127.0.0.1 рд▓рд╛рдЗрди рдЬреЛрдбрд╝рдХрд░ /etc/hosts рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред<nombre-de-dominio-guay>. рдЖрдкрдХреЛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдорд┐рд▓реЗрдЧрд╛:**

-   **рд╣рдореЗрд╢рд╛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдирд╛рдорд╕реНрдерд╛рдиреЛрдВ (рдЬреИрд╕реЗ рдкреНрд░реА, рдкреНрд░реЛ, рдбреЗрд╡, рдЖрджрд┐) рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреА рдЬрд╛рддреА рд╣реИред рд╣рдо рдЗрд╕ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдЕрднреНрдпрд╛рд╕ рдореЗрдВ рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдорд╛рдорд▓рд╛ рдФрд░ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рди рд╣реЛ, рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдЕрдЪреНрдЫреА рдмрд╛рдд рдпрд╣ рд╣реЛрдЧреА рдХрд┐ рдЬреЗрдирдХрд┐рдВрд╕ рдХреЛ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдЖрджрд┐ рд╕реЗ рдЕрд▓рдЧ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПред**

**----------------------------------------- рдпрд╣ -------- --------------------------------**

**рд╣рдо рдЗрд╕реНрддрд┐рдпреЛ рдХреЗ рдкрд╛рд╕ рдЬрд╛рддреЗ рд╣реИрдВред рдореЗрд░реЗ рдереЛрдбрд╝реЗ рд╕реЗ рдЕрдиреБрднрд╡ рдФрд░ рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рдкрдврд╝реЗ рдЧрдП рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рдХрд╛рд░рдг, рдЗрд╕реНрддрд┐рдпреЛ рд╕реНрдерд╛рдиреАрдп рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реА рд╕рдорд╕реНрдпрд╛рдПрдВ рдкреИрджрд╛ рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐, рдЕрдиреНрдп рдмрд╛рддреЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдмрд╛рд╣рд░ рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдЬреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣рдо рдмрдирд╛рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рд╡рд╣ рдЕрддреНрдпрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рдпрд╣ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ рдХрд┐ рд╕реЗрд╡рд╛ рдХреА рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХреНрдпрд╛ рд╣реИред**

**рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ:**

-   _"рдЧреЗрдЯрд╡реЗ" рдПрдХ рдЗрд╕реНрддрд┐рдпреЛ рдШрдЯрдХ рд╣реИ рдЬреЛ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдмрд╛рд╣рд░реА рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред_
-   _"рд╡рд░реНрдЪреБрдЕрд▓ рд╕рд░реНрд╡рд┐рд╕" рдПрдХ рдЗрд╕реНрддрд┐рдпреЛ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдЧреЗрдЯрд╡реЗ рд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдмреИрдХ-рдПрдВрдб рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдХреИрд╕реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред_

10. **рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЗрд╕реНрддрд┐рдпреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛:**

-   **рдЗрд╕реНрддрд┐рдпреЛ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ:**

```bash
curl -L https://istio.io/downloadIstio | sh -
cd istio-*
export PATH=$PWD/bin:$PATH
```

-   **рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕реАрдЖрд░рдбреА рдЗрд╕рдХреЗ рд╕рд╛рде рд╕реНрдерд╛рдкрд┐рдд рд╣реИрдВ:**

```bash
kubectl get crds | grep 'istio.io\|certmanager.k8s.io' | wc -l
```

-   **рдпрджрд┐ рд╣рдореЗрдВ 0 рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ:**

```bash
istioctl install --set profile=default
```

-   **рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдкреНрд░рд╡реЗрд╢ рджреНрд╡рд╛рд░ рдФрд░ рдПрдХ рдЗрд╕реНрддрд┐рдУ рдкреЙрдб рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:**

```bash
kubectl get pods -n istio-system
```

-   **рдЙрд╕ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддрд┐рдпреЛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдЕрдкрд╛рдЪреЗ, рдиреЗрдЧреНрдиреЗрдХреНрд╕ рдФрд░ рдЬреЗрдирдХрд┐рдВрд╕ рдкреЙрдб рддреИрдирд╛рдд рд╣реИрдВ:**

```bash
kubectl label namespace default istio-injection=enabled
```

11. **рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рдПрдХ рд╕рд░рд▓ рдЗрд╕реНрддрд┐рдпреЛ рд╕реЗрдЯрдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕реНрддрд┐рдпреЛ рдЯреНрд░реИрдлрд╝рд┐рдХ рдирд┐рдпрдВрддреНрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ nginx рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП:**

-   **nginx рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред рд╣рдо nginx рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддрд┐рдпреЛ рдореЗрдВ рдПрдХ рд╡рд░реНрдЪреБрдЕрд▓ рд╕рд░реНрд╡рд┐рд╕ рдФрд░ рдПрдХ рдЧреЗрдЯрд╡реЗ рдмрдирд╛рддреЗ рд╣реИрдВ:**

**рд▓реЛрдбрдмреИрд▓реЗрдВрд╕рд░Nginx.yaml:**

```yaml
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: nginx-vs
spec:
  hosts:
  - "*"
  gateways:
  - istio-gateway
  http:
  - match:
    - uri:
        prefix: /
    route:
    - destination:
        host: nginx
        port:
          number: 80
---
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: istio-gateway
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*"

```

```bash
kubectl apply -f loadBalancerNginx.yaml
```

**рдЧреНрд░реЗрдб:**

-   **рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рд╣рдореЗрдВ http&#x3A;// рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ nginx рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП<nodeIP>:30000. рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╕реНрдерд╛рдиреАрдп рдкреНрд░рдХрд╛рд░ рдкрд░ рдХрд╛рдо рдХрд░рдирд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЪреАрдЬреЛрдВ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рдХрдард┐рди рдмрдирд╛ рджреЗрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░рд╛ рдкрд░реНрдпрд╛рд╡рд░рдг рдмрд╛рд╣рд░реА рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░реНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдХреНрдпреВрдмрд▓реЗрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓, рдХреНрд▓рд╕реНрдЯрд░-рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдЗрддреНрдпрд╛рджрд┐ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рдЗрд╕реЗ рдареАрдХ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдПрдХ рдмрд╛рд╣рд░реА рдмреИрд▓реЗрдВрд╕рд░ рд╕рдорд░реНрдерд┐рдд рдерд╛, рддреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдирд┐рд░реНрдпрд╛рдд рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рд╣реЛрдЧреА (рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ wsl2 рдХреЗ рд▓рд┐рдП):**

```bash
export INGRESS_NAME=istio-ingressgateway
export INGRESS_NS=istio-system

export INGRESS_HOST=127.0.0.1

#check
kubectl get svc -n istio-system
echo "INGRESS_HOST=$INGRESS_HOST, INGRESS_PORT=$INGRESS_PORT"

export GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT
```

**рдпрджрд┐ рдЖрдк рдЗрд╕рдХреЗ рд╕рд╛рде рдЦрд┐рд▓рд╡рд╛рдбрд╝ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ nginx-nodeport.yaml рдлрд╝рд╛рдЗрд▓ рд╣реИ: nginx-nodeport.yaml:**

```bash
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: nginx-nodeport-vs
spec:
  hosts:
  - "*"
  gateways:
  - istio-gateway
  http:
  - match:
    - port: 30000
    route:
    - destination:
        host: nginx
        port:
          number: 80
```

-   **рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рддреИрдирд╛рддреА рдХреЛ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (рдпрд╛ рдкреЙрдбреНрд╕ рдХреЛ рд╣рдЯрд╛рдирд╛ рд╣реЛрдЧрд╛) рддрд╛рдХрд┐ рдЙрдирдореЗрдВ рдЖрдИрд╕реНрдЯрд┐рдпреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:**

```bash
kubectl rollout restart deployment nginx
kubectl rollout restart deployment apache
kubectl delete pods --all**
```

-   **рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕рдм рдХреБрдЫ рдареАрдХ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:**

```bash
istioctl analyze
kubectl get gateway
kubectl get vs
```

**------------------------------------------------ рдХрд┐рдЖрд▓реА -------- --------------------------------**

**рдпрд╣ рдорд╛рдирддреЗ рд╣реБрдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рд╣реИ рдЬреЛ рд╕рдм рдХреБрдЫ nginx рд░рд┐рд╡рд░реНрд╕-рдкреНрд░реЙрдХреНрд╕реА рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯреВрд▓ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВред рдХрд┐рдЖрд▓реА рдПрдХ рдЗрд╕реНрддрд┐рдпреЛ рдЯреНрд░реИрдХрд┐рдВрдЧ/рдбреИрд╢рдмреЛрд░реНрдб рдЯреВрд▓ рд╣реИ рдЬреЛ рдЗрд╕реНрддрд┐рдпреЛ рд╕реЗрд╡рд╛ рдЯреЛрдкреЛрд▓реЙрдЬреА рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдо рддреМрд░ рдкрд░ рддрдм рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдЗрд╕реНрддрд┐рдпреЛ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ рдпрджрд┐ рдкреНрд░реЛрдореЗрдерд┐рдпрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдЧреНрд░рд╛рдлрд╛рдирд╛ рдпрд╛ рдпрджрд┐ рдЗрд▓рд╛рд╕реНрдЯрд┐рдХ-рд╕рд░реНрдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдХрд┐рдмрд╛рдирд╛)ред рдЖрдЗрдП рдЗрд╕реЗ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ:**

12. **рдЗрдВрд╕реНрдЯрд╛рд▓рд░ рдХрд┐рдЕрд▓рд┐:**

```bash
kubectl  apply  -f  https://raw.githubuserconten 1.17/samples/addons/kiali.yaml --validate=false**
```

13. **рд╕реНрдерд╛рдкрдирд╛ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:**

```bash
kubectl -n istio-system get svc kiali
```

14. **рдбреИрд╢рдмреЛрд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:**

```bash
istioctl dashboard kiali
```

**рдирд┐рд╖реНрдХрд░реНрд╖:**

**рдЗрд╕реНрддрд┐рдпреЛ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рдВрдкреВрд░реНрдг рд╕реЗрд╡рд╛ рд╣реИ рдЬрд┐рд╕реЗ рдкреНрд░реЛрдореЗрдерд┐рдпрд╕, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдбреИрд╢рдмреЛрд░реНрдб рдФрд░ рдХрдИ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╣рдо рдЕрдЧрд▓реА рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛рдУрдВ рдореЗрдВ рдЗрд╕реНрддрд┐рдпреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░реЗрдВрдЧреЗ, рдЬрд╣рд╛рдВ рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдЗрд╕реНрддрд┐рдпреЛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░реЛрдореЗрдерд┐рдпрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдХреНрд▓рд╕реНрдЯрд░ рдирд┐рдЧрд░рд╛рдиреА рдкрд░ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реЗрдВрдЧреЗред**

**рдорд╣рддреНрд╡рдкреВрд░реНрдг рд▓реЗрдЦ:**

-   рдпрджрд┐ рдХрднреА рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рд╣реЛ, рддреЛ рд╕рдВрдкреВрд░реНрдг рдкрд░рд┐рджреГрд╢реНрдп рдХреЛ autoDeploy.py рдлрд╝рд╛рдЗрд▓ рдЪрд▓рд╛рдХрд░ рдПрдХрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдлрд╝рд╛рдЗрд▓ рдПрдХрд▓ рдЗрдирдкреБрдЯ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддреА рд╣реИ, рдЬреЛ рдХреНрд▓рд╕реНрдЯрд░ рдХрд╛ рдирд╛рдо рд╣реИред рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЫреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдирд╛рдо "рдЯреНрд░реЗрдирд┐рдВрдЧрдкрд╛рде" рд╣реИ (рдПрдВрдЯрд░ рджрдмрд╛рдПрдВ)ред

```bash
python3 autoDeploy.py
```

-   рдпрджрд┐ рдЖрдк wsl2 рдпрд╛ Linux рдбрд┐рд╕реНрдЯреНрд░реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ autoDeploy.sh рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд╛рдпрдерди рдирд┐рд░реНрдпрд╛рдд рдХреЗ рд╕рд╛рде рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рд╕реЗ рдмрдЪрд╛рддрд╛ рд╣реИред рдПрдХ рдЦрд╛рд▓реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЖрдкрдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

```bash
./autoDeploy.sh
```

-   (рдирд╡реАрдирддрдо) рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддрд┐рдпреЛ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ[рд╣рддреНрддрдкрдГ://рд┐рд╕реНрддрд┐рдУ.реАреЛ/рдбреМрдиреНрд▓реЛрдбрд┐рд╕реНрдЯрд┐рд╡](https://istio.io/downloadIstio))

**рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рдЗрд╕реНрддрд┐рдпреЛ рд╕рдВрджрд░реНрдн:**

-   [рд╣рддреНрддрдкрдГ://рд┐рд╕реНрддрд┐рдУ.реАреЛ/рд▓реЗрдЯреЗрд╕реНрдЯ/рдбреЙрдХреНрд╕/рдЯрд╛рд╕реНрдХрд╕/рдЯреНрд░реИрдлрд┐рдХ-рдореИрдиреЗрдЬрдореЗрдВрдЯ/рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕/рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕-рдХрдгреНрдЯреНрд░реЛрд▓/#реБрд╕рд┐рдВрдЧ-рдиреЛрдб-рдкреЛрд░реНрдЯреНрд╕-рдСреЮ-рдереЗ-рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕-рдЧреЗрдЯрд╡реЗ-рд╕рд░реНрд╡рд┐рд╕](https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control/#using-node-ports-of-the-ingress-gateway-service)

-   [рд╣рддреНрддрдкрдГ://рд┐рд╕реНрддрд┐рдУ.реАреЛ/рд▓реЗрдЯреЗрд╕реНрдЯ/рдбреЙрдХреНрд╕/рдЯрд╛рд╕реНрдХрд╕/рдЯреНрд░реИрдлрд┐рдХ-рдореИрдиреЗрдЬрдореЗрдВрдЯ/рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕/рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕-рдХрдгреНрдЯреНрд░реЛрд▓/#реБрд╕рд┐рдВрдЧ-рдиреЛрдб-рдкреЛрд░реНрдЯреНрд╕-рдСреЮ-рдереЗ-рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕-рдЧреЗрдЯрд╡реЗ-рд╕рд░реНрд╡рд┐рд╕](https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control/#using-node-ports-of-the-ingress-gateway-service)

-   [рд╣рддреНрддрдкрдГ://рд┐рд╕реНрддрд┐рдУ.реАреЛ/рд▓реЗрдЯреЗрд╕реНрдЯ/рдбреЙрдХреНрд╕/рдПрдХреНрд╕рд╛рдореНрдкреНрд▓реЗрд╕/рдмреБрдХрдЗрдВрдлреЛ/#рдбреЗрдЯрд░реНрдорд┐рдиреЗ-рдереЗ-рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕-рд┐рдк-рдПрдВрдб-рдкреЛрд░реНрдЯ](https://istio.io/latest/docs/examples/bookinfo/#determine-the-ingress-ip-and-port)

-   [рд╣рддреНрддрдкрдГ://рд┐рд╕реНрддрд┐рдУ.реАреЛ/рд▓реЗрдЯреЗрд╕реНрдЯ/рдбреЙрдХреНрд╕/рдПрдХреНрд╕рд╛рдореНрдкреНрд▓реЗрд╕/рдмреБрдХрдЗрдВрдлреЛ/#рдбреЗрдЯрд░реНрдорд┐рдиреЗ-рдереЗ-рдЗрдиреНрдЧреНрд░реЗрд╕реНрд╕-рд┐рдк-рдПрдВрдб-рдкреЛрд░реНрдЯ](https://istio.io/latest/docs/examples/bookinfo/#determine-the-ingress-ip-and-port)
